<!DOCTYPE html>
<html lang="en">
  <!-- Head -->
  <%- include('../../partials/head.ejs') %>
  <body>
    <!-- Header -->
    <%- include('../../partials/header.ejs') %>

    <!-- Sidebar -->
    <%- include('../../partials/sidebar.ejs') %>

    <!-- Main content-->
    <main class="authors">
      <h2>Authors</h2>

      <!-- Show validation errors -->
      <%- include("../../partials/errors.ejs") %>

      <!-- Search author-->
      <form action="/authors/search" method="get">
        <label class="visually-hidden" for="search">
          Search for Author
        </label>
        <input type="search" name="query" id="search"
         value="<%= locals.search ? search : '' %>"
         placeholder="Enter author name">
        <button type="submit">Search</button>
      </form>

      <!-- Add author -->
      <form action="/authors/new" method="get">
        <button type="submit">Add Author</button>
      </form>

      
      <% if (locals.filteredAuthors) { %>
        <% if(filteredAuthors.length > 0) { %>
          <!-- Show search results -->
          <h3>Search Results</h3>
          <% filteredAuthors.forEach(author => { %>
            <h3><%= author.full_name %></h3>
            <p>
              <% if (author.birth_date) { %>
                <% const date = new Date(author.birth_date) %>
                <time datetime="<%= date.toISOString().split('T')[0] %>">
                  DOB: <%= date.toLocaleDateString()  %>
                </time>
              <% } else { %>
                DOB: Unknown
              <% } %>
            </p>
            <hr>
          <% }) %>
          <a href="/authors">Back to Authors</a>
        <% } else { %>
          <p>Author not found</p>
        <% } %>        
      <% } else if (locals.authors) { %>
        <% if ( authors.length > 0) { %>
          <!-- Show all authors -->
          <h3>All Authors List</h3>

          <% authors.forEach(author => { %>
            <h3><%= author.full_name %></h3>
            <p>
              <% if (author.birth_date) { %>
                <% const date = new Date(author.birth_date) %>
                <time datetime="<%= date.toISOString().split('T')[0] %>">
                  DOB: <%= date.toLocaleDateString()  %>
                </time>
              <% } else { %>
                DOB: Unknown
              <% } %>
            </p>

            <!-- Update author -->
            <form action="/authors/<%= author.id %>/update" method="get" >
              <button type="submit" >Update</button>
            </form>

            <!-- Delete author -->
            <form action="/authors/<%= author.id %>/delete" method="POST" >
              <button type="submit" onclick="return confirm('Warning: This will delete ALL data for this author!');">Delete Author</button>
            </form> 
            
            <hr>
          <% }) %>
        <% } else { %>
          <p>Start by adding some authors</p>
        <% } %>
      <% } %>      
    </main>

    <!-- Footer -->
    <%- include('../../partials/footer.ejs') %>
  </body>
</html>
